/**
 * å¹³å°é…ç½®æ–‡ä»¶
 * å®šä¹‰ä¸åŒCTFå¹³å°çš„ç‰¹å®šé…ç½®å’Œé€‰æ‹©å™¨
 */

const PLATFORM_CONFIGS = {
    'nssctf.cn': {
        name: 'NSSCTF',
        titleProcessor: (title) => {
            // NSSCTFç‰¹å®šçš„æ ‡é¢˜å¤„ç†é€»è¾‘
            title = title.split('|')[0].trim();
            title = title.replace(/[?|:<>"*\/\\]/g, '');

            const bracketRegex = /\[([^\]]+)\]/g;
            const bracketContents = [];
            let match;

            while ((match = bracketRegex.exec(title)) !== null) {
                bracketContents.push(match[1].trim());
            }

            const problemName = title.split(']').pop().trim();
            let formattedTitle = bracketContents.join('-');

            if (problemName && problemName !== formattedTitle) {
                formattedTitle = formattedTitle ? `${formattedTitle}-${problemName}` : problemName;
            }

            return formattedTitle.replace(/[-\s]+/g, '-').replace(/^-+|-+$/g, '') || 'Unknown';
        }
    },

    'ctf.show': {
        name: 'CTF Show',
        titleProcessor: (title) => {
            // CTF Showç‰¹å®šçš„æ ‡é¢˜å¤„ç†é€»è¾‘
            title = title.replace(/CTF Show/gi, '').trim();
            title = title.replace(/[?|:<>"*\/\\]/g, '');
            return title.replace(/[-\s]+/g, '-').replace(/^-+|-+$/g, '') || 'Unknown';
        }
    },

    'buuoj.cn': {
        name: 'BUUOJ',
        titleProcessor: (title) => {
            // BUUOJç‰¹å®šçš„æ ‡é¢˜å¤„ç†é€»è¾‘
            title = title.replace(/BUUOJ/gi, '').trim();
            title = title.replace(/[?|:<>"*\/\\]/g, '');
            return title.replace(/[-\s]+/g, '-').replace(/^-+|-+$/g, '') || 'Unknown';
        }
    }
};

/**
 * é»˜è®¤æ¨¡æ¿é…ç½®
 */
const DEFAULT_TEMPLATES = {
    standard: {
        name: 'æ ‡å‡†æ¨¡æ¿',
        content: `## åŸºæœ¬ä¿¡æ¯
- **é¢˜ç›®åç§°**ï¼š{{title}}
- **é¢˜ç›®é“¾æ¥**ï¼š{{url}}
- **åˆ›å»ºæ—¶é—´**ï¼š{{date}} {{time}}
- **è€ƒç‚¹æ¸…å•**ï¼š

## è§£é¢˜æ€è·¯


## è¿‡ç¨‹å’Œç»“æœè®°å½•


## æ€»ç»“


## ç›¸å…³çŸ¥è¯†ç‚¹


---
*Generated by Obsidian WriteUp Helper*`
    },
    
    detailed: {
        name: 'è¯¦ç»†æ¨¡æ¿',
        content: `# {{title}}

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯
| é¡¹ç›® | å†…å®¹ |
|------|------|
| é¢˜ç›®åç§° | {{title}} |
| é¢˜ç›®é“¾æ¥ | {{url}} |
| åˆ›å»ºæ—¶é—´ | {{date}} {{time}} |

## ğŸ¯ è€ƒç‚¹æ¸…å•
- [ ]

## ğŸ’¡ è§£é¢˜æ€è·¯


## ğŸ“ è¿‡ç¨‹å’Œç»“æœè®°å½•


## ğŸ” è¯¦ç»†åˆ†æ


## ğŸ“š ç›¸å…³çŸ¥è¯†ç‚¹


## ğŸ‰ æ€»ç»“


## ğŸ”— å‚è€ƒèµ„æ–™


---
*Generated by Obsidian WriteUp Helper v2.0*`
    },
    
    simple: {
        name: 'ç®€æ´æ¨¡æ¿',
        content: `# {{title}}

**é“¾æ¥**: {{url}}
**æ—¶é—´**: {{date}}

## æ€è·¯


## è¿‡ç¨‹


## æ€»ç»“

`
    }
};

/**
 * è·å–å½“å‰å¹³å°é…ç½®
 * @returns {Object} å¹³å°é…ç½®å¯¹è±¡
 */
function getCurrentPlatformConfig() {
    try {
        if (typeof window === 'undefined' || !window.location) {
            console.warn('WriteUp Helper: æ— æ³•è·å–window.locationï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
            return PLATFORM_CONFIGS['nssctf.cn'];
        }

        const hostname = window.location.hostname;

        for (const [domain, config] of Object.entries(PLATFORM_CONFIGS)) {
            if (hostname.includes(domain)) {
                return config;
            }
        }

        // è¿”å›é»˜è®¤é…ç½®
        return PLATFORM_CONFIGS['nssctf.cn'];
    } catch (error) {
        console.error('WriteUp Helper: è·å–å¹³å°é…ç½®å¤±è´¥', error);
        return PLATFORM_CONFIGS['nssctf.cn'];
    }
}

/**
 * å¯¼å‡ºé…ç½®
 */
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        PLATFORM_CONFIGS,
        DEFAULT_TEMPLATES,
        getCurrentPlatformConfig
    };
}
